# Enable rewrite
RewriteEngine On

# Never rewrite real files or directories
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Redirect /index.php (or /foo/index.php) to clean slash
RewriteCond %{THE_REQUEST} \s(?:.*/)?index\.php [NC]
RewriteRule (^|/+)index\.php$ $1 [R=301,L,QSA]

# Redirect /index (or /foo/index) to clean slash
RewriteRule (^|/+)index/?$ $1 [R=301,L]

# Redirect any other public .php URL to its clean counterpart
RewriteCond %{THE_REQUEST} \s/([^\s]+?)\.php\b [NC]
RewriteRule ^(.+?)\.php$ /$1 [R=301,L,QSA]

# Internally serve *.php when the clean URL exists as a .php file
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+?)/?$ $1.php [L]
